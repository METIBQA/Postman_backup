{
	"info": {
		"_postman_id": "52489835-2455-4f55-916a-4288a10fb36f",
		"name": "Выписка",
		"schema": "https://schema.getpostman.com/json/collection/v2.0.0/collection.json"
	},
	"item": [
		{
			"name": "Regression",
			"item": [
				{
					"name": "#4076. Выписка по нескольким счетам разных клиентов",
					"item": [
						{
							"name": "Авторизация",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											""
										],
										"type": "text/javascript",
										"id": "1bdc7dd5-54d4-48fa-8ab4-0929ae4c01f3"
									}
								}
							],
							"id": "45b295e0-2652-4b73-aad4-da54d0a951cf",
							"protocolProfileBehavior": {
								"disableBodyPruning": true
							},
							"request": {
								"auth": {
									"type": "basic",
									"basic": {
										"password": "{{password}}",
										"username": "{{login}}"
									}
								},
								"method": "POST",
								"header": [],
								"url": "{{host}}/rest/stateful/corp/login"
							},
							"response": []
						},
						{
							"name": "Описание теста",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"//Вся информация по данному функционалу лежит по ссылке - http://confl-srv01.hq.metib.ru:8090/pages/viewpage.action?pageId=49775022"
										],
										"type": "text/javascript",
										"id": "79eca792-44a6-4041-be01-3952056c7f37"
									}
								}
							],
							"id": "065876de-ead4-45a8-bab2-1bdf97818778",
							"protocolProfileBehavior": {
								"disableBodyPruning": true
							},
							"request": {
								"method": "GET",
								"header": [],
								"url": "{{host}}/assets/config/version.json"
							},
							"response": []
						},
						{
							"name": "Параметры теста",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"//Здесь нужно указать номера счетов, по которым в следующем запросе определяются их id и затем формируется выписка по этим счетам. Если неуказывать никаие счета, то выписка будет формироваться по счетам всех компаний, которые подключены к учетной записи",
											"pm.environment.set(\"account_number_1\", \"40702156414000060778\"); //Номер счета первого клиента - АО \"ВМЗ\"",
											"pm.environment.set(\"account_number_2\", \"40802810200990000023\"); //Номер счета второго клиента - Захарова Яна"
										],
										"type": "text/javascript",
										"id": "86633770-b76b-4682-83a2-7ba735f2dbdb"
									}
								}
							],
							"id": "2d2bf644-8b7f-4271-978d-f96707f44b93",
							"protocolProfileBehavior": {
								"disableBodyPruning": true
							},
							"request": {
								"method": "GET",
								"header": [],
								"url": "{{host}}/assets/config/version.json"
							},
							"response": []
						},
						{
							"name": "Смена клиента ВМЗ",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											""
										],
										"type": "text/javascript",
										"id": "99cebcd6-9aad-4516-990b-40df73344775"
									}
								}
							],
							"id": "4db0a1bd-f87f-4377-aead-37d04cfce4db",
							"protocolProfileBehavior": {
								"disableBodyPruning": true
							},
							"request": {
								"method": "PUT",
								"header": [],
								"url": {
									"raw": "{{host}}/rest/stateful/corp/company/change_active/6905198",
									"host": [
										"{{host}}"
									],
									"path": [
										"rest",
										"stateful",
										"corp",
										"company",
										"change_active",
										"6905198"
									],
									"query": [
										{
											"key": "6905198",
											"value": "6905198",
											"description": "ВМЗ (ПРЕПРОД)",
											"disabled": true
										}
									]
								}
							},
							"response": []
						},
						{
							"name": "Получаем id счетов для выписки",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"var json = pm.response.json().accounts;",
											"",
											"var arr = null;",
											"for (var i = 0; i < json.length; i++) {",
											"",
											"    if (json[i].number.includes(pm.environment.get(\"account_number_1\"))) { //Номер счета, по которому нужны id",
											"        if (arr == null) {",
											"            arr = Number(json[i].id);",
											"        }",
											"        else {",
											"            arr = arr + \";\" + Number(json[i].id);",
											"        }",
											"    }",
											"}",
											"",
											"for (var i = 0; i < json.length; i++) {",
											"",
											"    if (json[i].number.includes(pm.environment.get(\"account_number_2\"))) { //Номер счета, по которому нужны id",
											"        if (arr == null) {",
											"            arr = Number(json[i].id);",
											"        }",
											"        else {",
											"            arr = arr + \";\" + Number(json[i].id);",
											"        }",
											"    }",
											"}",
											"",
											"// arr = arr.filter(n => n)  //Удаляю пусные элементы из массива",
											"pm.environment.set(\"array_accounts\", arr);",
											"",
											"// Печатаю список счетов в консоль",
											"console.log(pm.environment.replaceIn('{{array_accounts}}'));"
										],
										"type": "text/javascript",
										"id": "294516b0-e1e6-4625-9f66-5bf0e2f21a41"
									}
								}
							],
							"id": "d2ed4c1e-41af-4c43-91d3-abad00e585cd",
							"protocolProfileBehavior": {
								"disableBodyPruning": true
							},
							"request": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{host}}/rest/stateful/corp/product?sync=true&with_blocked=true&with_stays=true",
									"host": [
										"{{host}}"
									],
									"path": [
										"rest",
										"stateful",
										"corp",
										"product"
									],
									"query": [
										{
											"key": "sync",
											"value": "true"
										},
										{
											"key": "with_blocked",
											"value": "true"
										},
										{
											"key": "with_stays",
											"value": "true"
										}
									]
								}
							},
							"response": []
						},
						{
							"name": "(Не запускать) Получаем id по ВСЕМ счетам для выписки",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"var json = pm.response.json().accounts;",
											"",
											"var arr = []",
											"for (var i = 0; i < json.length; i++) {",
											"    arr.push(Number(json[i].id));",
											"}",
											"",
											"//Удаляю пусные элементы из массива",
											"arr = arr.filter(n => n)",
											"",
											"// Преобразуем значения массива в строку, разделенную точкой с запятой",
											"var arrString = arr.join(\";\");",
											"",
											"//Записываю значения из arr в переменную окружения array_accounts",
											"pm.environment.set(\"array_accounts\", arrString);",
											"",
											"// Печатаю список счетов в консоль",
											"// console.log(pm.environment.replaceIn('{{array_accounts}}'));",
											"console.log(pm.environment.replaceIn('{{array_accounts}}'));"
										],
										"type": "text/javascript",
										"id": "330c7432-6650-4ea3-8269-d62e88455f6f"
									}
								}
							],
							"id": "52cbbb7d-f27a-4ace-9988-9002016a194e",
							"protocolProfileBehavior": {
								"disableBodyPruning": true
							},
							"request": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{host}}/rest/stateful/corp/product?sync=true&with_blocked=true&with_stays=true",
									"host": [
										"{{host}}"
									],
									"path": [
										"rest",
										"stateful",
										"corp",
										"product"
									],
									"query": [
										{
											"key": "sync",
											"value": "true"
										},
										{
											"key": "with_blocked",
											"value": "true"
										},
										{
											"key": "with_stays",
											"value": "true"
										}
									]
								}
							},
							"response": []
						},
						{
							"name": "Запрос выписки по нескольким счетам",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											""
										],
										"type": "text/javascript",
										"id": "2232d9d4-9199-452c-b84e-e2ad6628944d"
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"var json = pm.response.json().statementAnswer;",
											"",
											"var arr = [];",
											"for (var i = 0; i < json.length; i++) {",
											"    arr[i] = Number(json[i].id);",
											"}",
											"pm.environment.set(\"array_vipiska\", arr);",
											""
										],
										"type": "text/javascript",
										"id": "1c120c70-20ff-4bde-ad2d-009e6bf1a61e"
									}
								}
							],
							"id": "4ca3f12d-6342-4459-bdf1-992d5cf785e1",
							"protocolProfileBehavior": {
								"disableBodyPruning": true
							},
							"request": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{host}}/rest/stateful/corp/statement/offline_metinv/ul_get_stmt?acc_id_list={{array_accounts}}&begin_date=2023-01-09&end_date=2023-02-10",
									"host": [
										"{{host}}"
									],
									"path": [
										"rest",
										"stateful",
										"corp",
										"statement",
										"offline_metinv",
										"ul_get_stmt"
									],
									"query": [
										{
											"key": "acc_id_list",
											"value": "8110042",
											"disabled": true
										},
										{
											"key": "acc_id_list",
											"value": "{{array_accounts}}"
										},
										{
											"key": "begin_date",
											"value": "2023-01-09"
										},
										{
											"key": "end_date",
											"value": "2023-02-10"
										}
									]
								}
							},
							"response": []
						},
						{
							"name": "Печать PDF",
							"id": "e3c2ea11-7407-4e23-9ea1-2fcfb6c4cc18",
							"protocolProfileBehavior": {
								"disableBodyPruning": true
							},
							"request": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{host}}/rest/stateful/corp/metinv/print/stm_pdf?&doc_ids={{array_vipiska}}&print_mode=only_stmnt",
									"host": [
										"{{host}}"
									],
									"path": [
										"rest",
										"stateful",
										"corp",
										"metinv",
										"print",
										"stm_pdf"
									],
									"query": [
										{
											"key": null,
											"value": null
										},
										{
											"key": "doc_ids",
											"value": "{{array_vipiska}}"
										},
										{
											"key": "print_mode",
											"value": "only_stmnt"
										}
									]
								}
							},
							"response": []
						},
						{
							"name": "Печать 1С",
							"id": "1cb56e9d-9a74-4a99-86fe-e771b2b918ad",
							"protocolProfileBehavior": {
								"disableBodyPruning": true
							},
							"request": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{host}}/rest/stateful/corp/statement/offline_metinv/ul_get_stmt_1c?begin_date=2023-01-03&end_date=2023-02-01&acc_id_list={{array_accounts}}&version=1.01&mode=only_stmnt",
									"host": [
										"{{host}}"
									],
									"path": [
										"rest",
										"stateful",
										"corp",
										"statement",
										"offline_metinv",
										"ul_get_stmt_1c"
									],
									"query": [
										{
											"key": "begin_date",
											"value": "2023-01-03"
										},
										{
											"key": "end_date",
											"value": "2023-02-01"
										},
										{
											"key": "acc_id_list",
											"value": "{{array_accounts}}"
										},
										{
											"key": "acc_id_list",
											"value": "1658079;1560790",
											"description": "1658079 - счет ВМЗ; 1560790 - Счет Захарова",
											"disabled": true
										},
										{
											"key": "version",
											"value": "1.01"
										},
										{
											"key": "mode",
											"value": "only_stmnt"
										}
									]
								}
							},
							"response": []
						}
					],
					"id": "086c6310-d668-4358-bd59-a825b3f7bc14"
				}
			],
			"id": "7b174ac2-ffe6-4863-b21b-38b87fbf64a2"
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					""
				],
				"id": "d1354244-c234-4bd4-afad-a80b13953452"
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					"pm.test(\"Status code is 200\", function () {",
					"    pm.response.to.have.status(200);",
					"});"
				],
				"id": "09e26a95-5302-4e32-bdd8-bf6956679934"
			}
		}
	]
}